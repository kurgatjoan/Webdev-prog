
<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="./output.css" rel="stylesheet">
 
</head>
<body>

  <!--parent-->
  <div class="h-screen flex">
    <!--leftpane-->
    <div class="bg-blue-950 h-full w-1/6">
      <header class="text-white text-2xl font-bold p-4">Bankers</header>
      <div class=" font-serif text-white">
        <div>
            <ul class="menu menu-md flex-col ml-3">
                <li><a href="wallet.html" class="p-2  hover:text-black duration-500 flex"><img src="C:\Users\ELITEBOOK\Desktop\Webdev prog\src\images\wallet (2).png" class="w-6 h-6 " alt="wallet icon"> Wallet</a></li>
                <li> <a href="#" class="p-2  hover:text-black duration-500"><img src="C:\Users\ELITEBOOK\Desktop\Webdev prog\src\images\send.png" class="w-6 h-6 " alt="send icon">Send Money</a></li>
                <li>  <a href="withdraw.html" class="p-2 hover:text-black duration-500"><img src="C:\Users\ELITEBOOK\Desktop\Webdev prog\src\images\money-withdrawal.png" class="w-6 h-6 " alt="withdraw icon">Withdraw Money</a></li>
              </ul>

        </div>
        <div>
            <ul class="menu menu-md flex-col ml-3 p-2 absolute bottom-0 left-0">
                <li> <a href="Settings.html" class="p-0 hover:text-black duration-500"><img src="C:\Users\ELITEBOOK\Desktop\Webdev prog\src\images\settings.png" class="w-6 h-6 " alt="settings icon">Settings</a></li>
                <div class="divider w-48 p-0"></div> 
                <li> <a href="user.html" class="p-0 font-bold hover:text-black duration-500"><img src="C:\Users\ELITEBOOK\Desktop\Webdev prog\src\images\user (1).png" class="w-6 h-6 " alt="user icon">User</a></li>
            </ul>
        </div>
      </div>
    </div>
    <!--rightpane-->
    <div class="bg-white w-5/6 h-full overflow-scroll">
      <!--navbar-->
    
      <div class="ml-7">
       <div class="navbar bg-white text-amber-600 ">
          <div class="flex-none">
           
      
            </button>
          </div>
         <div class="grid">
            <label for="Send Cash" class="text-4xl font-bold text-pretty text-cyan-700  ">Send Cash</label>
            <p class=" text-pretty text-sm">Manage your money with ease</p>
          </div>
         
        </div>
        <div>
          <div class="flex text-2xl">
            <div id="balance" class="card w-96 bg-white shadow-lg flex text-2xl mt-3 p-2 text-black font-serif font-bold">
                <div class="card-body p-1"> 
                    Balance <br>
                    KSH. 50,000
                </div>
            </div>
            <div id="send" class="card w-96 bg-white shadow-lg flex text-2xl mt-3 p-2 text-black font-serif font-bold">
              <div class="card-body p-1"> 
                  Send<br>
                  KSH. 0
              </div>
          </div>

            </div>
          
         <div>
          <div class="flex  mt-8 ">
            <div>
              <label for="chooserecipient" class="text-black text-2xl text-pretty  ml-7 font-bold">Choose Recipient</label>
            </div>
            <!-- <div class="flex justify-center  ml-16">
              <input type="text" id="amount" placeholder=" Search" class="input input-bordered"> <button class="btn border-none b  ml-3 " onclick="searchPhoneNumber()">
              <img src="C:\Users\ELITEBOOK\Desktop\Webdev prog\src\images\search.png" class="w-4 h-4" />
              </button>
            </div> -->
          </div>
          <div class="flex ">
            <div class="flex mt-4 ">
              <form name="myform" id="myform">
                <table id="myTable">
                  <thead>
                    <tr>
                      <th>First Name</th>
                      <th>Surname</th>
                      <th>Phone Number</th>
                      <th>Select</th>
                      <th> Delete</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><input type="text" name="fname" value=""></td>
                      <td><input type="text" name="surname" value=""></td>
                      <td><input type="text" name="phone" value=""></td>
                      <td>
                        
                        <input type="checkbox" name="selected" value="true" onclick="showSendMoney()">
                      </td>
                      <td>
                        
                        <button type="button" class="delete-btn btn" >Delete</button>
                      </td>
                    </tr>
                  
                  </tbody>
                </table>
                
                <button class="add-btn btn" class="btn">Add Contact</button>
            </form>
            <script>
             
                const tableBody = document.querySelector('#myTable tbody');
                const addBtn = document.querySelector('.add-btn');
                addBtn.addEventListener('click', () => {
                const newRow = document.createElement('tr');
                newRow.innerHTML = `
                <td><input type="text" name="fname" value=""></td>
                <td><input type="text" name="surname" value=""></td>
                <td><input type="text" name="phone" value=""></td>
                <td>
               
                <input type="checkbox" name="checkbox" value="true">
                </td>
                <td> 
                  <button class="delete-btn">Delete</button>
                </td>
                `;
                
                tableBody.appendChild(newRow);
                });
                 table = document.getElementById("myTable");
                table.addEventListener("input", () => {
                  
                const tableData = [];
                for (let i = 0; i < table.rows.length; i++) {
                const row = table.rows[i];
                const rowData = {};
                for (let j = 0; j< row.cells.length; j++) {
                  const cell = row.cells[j];
                  if (cell.firstChild && cell.firstChild.type === "text") {
                    rowData[cell.firstChild.name] = cell.firstChild.value;
                  }
                  if (cell.firstChild && cell.firstChild.type === "checkbox") {
                    rowData["checkbox"] = cell.firstChild.checked;
                  }
                }
                tableData.push(rowData);
                }
                localStorage.setItem("tableData", JSON.stringify(tableData));
                });
                //Delete button
                table.addEventListener('click', (event) => {
                  if (event.target.classList.contains('delete-btn')) {
                    table.deleteRow(event.target.closest('tr').rowIndex);
                    saveData();
                  }
                });
                 // Send amount to the selected contact
                //  table.addEventListener('click', (event) => {

                //   if (event.target.parentElement.querySelector('input[type="checkbox"]').checked) {
                    
                //     const amount = prompt('Enter an amount to be sent to this contact:');
                //     if (amount) {
                      // Send the amount to the selected contact
                //       console.log(`Sending $${amount} to ${event.target.parentElement.previousElementSibling.querySelector('input[type="text"][name="fname"]').value} ${event.target.parentElement.previousElementSibling.querySelector('input[type="text"][name="surname"]').value}`);
                //     }
                //   }
                // });
  
                // Loading the table data from the local storage
                window.addEventListener("load", () => {
                const tableData = JSON.parse(localStorage.getItem("tableData"));
                if (tableData) {
                for (let i = 1; i < tableData.length; i++) {
                  const newRow = document.createElement('tr');
                  newRow.innerHTML = `
                    <td><input type="text" name="fname" value="${tableData[i].fname}"></td>
                    <td><input type="text" name="surname" value="${tableData[i].surname}"></td>
                    <td><input type="text" name="phone" value="${tableData[i].phone}"></td>
                    <td><input type="checkbox" name="checkbox" value="true" ${tableData[i].checkbox ? "checked" : ""}></td>
                    
                    <td> 
                      <button class="delete-btn btn">Delete</button></td>
                  `;
                  tableBody.appendChild(newRow);
                }
                
                }
                });
            </script>
  
  
            </div>
  
            <div id='sendmoney'  > 
              <form id="sendMoneyForm" class=" grid grid-row-3 ml-16">
                <label for="amounttosend" class="text-black text-2xl text-pretty  font-bold">Amount to Send</label>
                <input type="text" id="amounttosend" placeholder="KSH." class="input input-bordered">
                <button id="send-btn" type="submit" class="btn border-none bg-yellow-200  rounded-full text-black mt-5" >
                    <img src="C:\Users\ELITEBOOK\Desktop\Webdev prog\src\images\transfer.png" class="w-4 h-4" />
                    Send Money
                </button>  
              </form>
              
                <script>
                  // Get references to HTML elements
                  const balanceElement = document.getElementById('balance');
                  const sendElement = document.getElementById('send');
                  const sendForm = document.getElementById('sendMoneyForm');
                  const sendBtn = document.getElementById('send-btn');
                  const table = document.getElementById('myTable');

                  // Function to update balance and send amount
                  function updateBalanceAndSend(amount) {
                      // Extract numerical balance value
                      let currentBalanceText = balanceElement.innerText.trim(); // Remove leading/trailing whitespace
                      let currentBalanceStr = currentBalanceText.split(' ')[1]; // Split by space and get the second part
                      let currentBalance = parseFloat(currentBalanceStr.replace(',', '')); // Remove commas and parse as float

                      // Check if the user has sufficient balance
                      if (currentBalance < amount) {
                          alert("You do not have sufficient balance to send that amount.");
                          return;
                      }

                      // Deduct amount from balance
                      currentBalance -= amount;

                      // Format updated balance
                      const formattedBalance = 'KSH. ' + currentBalance.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');

                      // Update balance
                      balanceElement.innerText = formattedBalance;

                      // Display success message
                      alert(`Transaction successful! ${amount} KSH sent.`);
                  }

                  // Event listener for form submission
                  sendForm.addEventListener('submit', function(event) {
                      event.preventDefault(); // Prevent default form submission behavior

                      // Get the value entered in the send amount input field
                      const sendAmount = parseFloat(sendForm.amounttosend.value);

                      // Check if the send amount is valid
                      if (isNaN(sendAmount) || sendAmount <= 0) {
                          alert("Please enter a valid send amount.");
                          return;
                      }

                      // Call function to update balance and send amount
                      updateBalanceAndSend(sendAmount);

                      // Reset the send amount input field
                      sendForm.amounttosend.value = '';
                  });

                  // Event listener for sending money to selected contacts
                  table.addEventListener('click', (event) => {
                      if (event.target.tagName === 'BUTTON' && event.target.classList.contains('delete-btn')) {
                          // Retrieve the row of the selected contact
                          const selectedRow = event.target.closest('tr');

                          // Check if the checkbox for this row is checked
                          const checkbox = selectedRow.querySelector('input[type="checkbox"]');
                          if (checkbox.checked) {
                              // Retrieve the amount entered by the user
                              const amount = parseFloat(prompt('Enter an amount to be sent to this contact:'));

                              // Check if the entered amount is valid
                              if (!isNaN(amount) && amount > 0) {
                                  // Call function to update balance and send amount
                                  updateBalanceAndSend(amount);
                              } else {
                                  alert("Please enter a valid amount.");
                              }
                          } else {
                              alert("Please select a contact.");
                          }
                        const sendtransaction = {
                          amount: amount,
                          
                            firstName: selectedRow.querySelector('input[name="fname"]').value,
                            lastName: selectedRow.querySelector('input[name="surname"]').value,
                            phoneNumber: selectedRow.querySelector('input[name="phone"]').value
                          }
                        };
                        const sendTable = []
                        localStorage.setItem('sendTable', JSON.stringify(sendTable));
                        sendTable.push(sendtransaction);
                        localStorage.setItem('sendTable', JSON.stringify(sendTable)); 
                      
                      }
                  );
                  window.addEventListener('load', () => {
    const storedBalance = localStorage.getItem('balance');
    if (storedBalance) {
      // Update the balance element with the stored balance
      balanceElement.innerText = 'KSH. ' + parseFloat(storedBalance).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
    }

    const lastTransaction = JSON.parse(localStorage.getItem('lastTransaction'));
    if (lastTransaction) {
      // You can use this data as needed, for example, display it to the user
      console.log('Last transaction details:', lastTransaction);
    }
  });
                </script>
              </div>     
            </div>
      
        </div>
      </div>
    </div>

      
  
</body>
</html>


